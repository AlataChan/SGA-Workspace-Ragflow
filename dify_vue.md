æ·±åº¦é›†æˆDify APIï¼šåŸºäºVue 3çš„æ™ºèƒ½å¯¹è¯å‰ç«¯è§£å†³æ–¹æ¡ˆï¼ˆä¸€ï¼‰
é¡¹ç›®æ¦‚è¿°
Difyç¼–æ’çš„Chatflowå·¥ä½œæµå…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§å’Œæ˜“ç”¨æ€§ï¼Œåœ¨å¾ˆå¤šåœºæ™¯å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œä½†æ˜¯Difyæä¾›çš„å‰ç«¯å‘å¸ƒæ–¹å¼ä¾‹å¦‚åµŒå…¥ç½‘ç«™æˆ–è€…å‘å¸ƒæˆWeb Appï¼Œæ•ˆæœå‘ˆç°éƒ½å¾ˆä¸çµæ´»æˆ–è€…æ¯”è¾ƒç®€é™‹ï¼Œéš¾ä»¥åº”ç”¨åœ¨è¦æ±‚è¾ƒé«˜çš„åœºåˆã€‚ä½†æ˜¯Difyæä¾›äº†å¼ºå¤§çš„APIæ–¹å¼ï¼Œå¯ä»¥å’Œä¸“ä¸šå¼€å‘çš„å‰ç«¯å¯¹è¯ç•Œé¢å®ç°å‰åç«¯é›†æˆã€‚æœ¬æ–‡å°±æ­¤åŸºäºVue3å®ç°äº† Vue Dify Chatï¼Œå®ç°äº†ç±»ä¼¼ ChatGPT çš„æµç•…å¯¹è¯ä½“éªŒï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨åŸºäºç°ä»£å‰ç«¯æŠ€æœ¯æ ˆæ„å»ºçš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼Œä¸“é—¨ä¸º Dify å·¥ä½œæµ API è¿›è¡Œäº†æ·±åº¦å®šåˆ¶å’Œä¼˜åŒ–ï¼Œå®ç°å’ŒDify APIæ·±åº¦é›†æˆï¼ŒåŒ…æ‹¬æ¶ˆæ¯å¯¹è¯ã€ç‚¹èµ/ç‚¹è¸©ã€å†å²æ¶ˆæ¯å‘ˆç°ã€æµå¼è¾“å‡ºã€åœæ­¢å¯¹è¯è¾“å‡ºç­‰APIï¼Œæ­¤å¤–é‡‡ç”¨Markdownç•Œé¢æ¸²æŸ“ï¼Œå¯ä»¥å‘ˆç°æ–‡æ¡£å›¾ç‰‡ï¼Œå¹¶ä¸”å¯¹äºå¤§æ¨¡å‹çš„æ€è€ƒè¾“å‡ºï¼Œå’Œæ­£æ–‡è¾“å‡ºåŒºåˆ«å‘ˆç°ï¼Œè¾¾åˆ°æ›´ç¾è§‚çš„æ•ˆæœã€‚ä¸‹å›¾æ˜¯ç•Œé¢æ•ˆæœã€‚

å›¾ç‰‡
âœ¨ åŠŸèƒ½ç‰¹æ€§
ğŸ¨ ç”¨æˆ·ç•Œé¢
ç±» ChatGPT å¸ƒå±€ï¼šå·¦ä¾§è¾¹æ  + å³ä¾§ä¸»èŠå¤©åŒº
å“åº”å¼è®¾è®¡ï¼šå®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
ä¼˜é›…çš„ UIï¼šåŸºäº Ant Design Vue ç»„ä»¶åº“
æš—è‰²ä¾§è¾¹æ ï¼šç°ä»£åŒ–çš„è§†è§‰è®¾è®¡
ğŸ’¬ å¯¹è¯åŠŸèƒ½
å®æ—¶æµå¼å“åº”ï¼šåŸºäº Server-Sent Events çš„é€å­—è¾“å‡º
åœæ­¢ç”Ÿæˆï¼šå¯éšæ—¶ä¸­æ–­AIå›ç­”çš„ç”Ÿæˆè¿‡ç¨‹
Markdown æ¸²æŸ“ï¼šæ”¯æŒä»£ç é«˜äº®ã€è¡¨æ ¼ã€é“¾æ¥ç­‰
æ€è€ƒè¿‡ç¨‹æ˜¾ç¤ºï¼šç‰¹æ®Šå¤„ç† <think></think>æ ‡ç­¾ï¼Œç”¨ç°è‰²å°å­—ä½“æ˜¾ç¤ºAIæ€è€ƒè¿‡ç¨‹
æ¶ˆæ¯æ“ä½œï¼šä¸€é”®å¤åˆ¶ã€ç‚¹èµã€ç‚¹è¸©åŠŸèƒ½
å“åº”ç»Ÿè®¡ï¼šæ˜¾ç¤ºæ¶ˆæ¯æ•°é‡å’ŒçŠ¶æ€ä¿¡æ¯
ğŸ“± äº¤äº’ä½“éªŒ
æ–°å»ºå¯¹è¯ï¼šå¿«é€Ÿåˆ›å»ºæ–°çš„èŠå¤©ä¼šè¯
å†å²ç®¡ç†ï¼šè‡ªåŠ¨åŠ è½½å’Œæµè§ˆDifyæœåŠ¡å™¨çš„å†å²å¯¹è¯è®°å½•
ä¼šè¯æ¢å¤ï¼šç‚¹å‡»å†å²ä¼šè¯å¯å®Œæ•´æ¢å¤å¯¹è¯å†…å®¹å¹¶ç»§ç»­æé—®
é”™è¯¯å¤„ç†ï¼šå‹å¥½çš„é”™è¯¯æç¤ºå’Œé‡è¯•æœºåˆ¶
åŠ è½½çŠ¶æ€ï¼šæ¸…æ™°çš„åŠ è½½åŠ¨ç”»å’ŒçŠ¶æ€æŒ‡ç¤º
æ ¸å¿ƒç‰¹è‰²
è¿™ä¸ªé¡¹ç›®çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå®ƒå°†å¤æ‚çš„AIå¯¹è¯åŠŸèƒ½åˆ†è§£ä¸ºæ¸…æ™°ã€å¯ç»´æŠ¤çš„æ¨¡å—åŒ–æ¶æ„ã€‚é€šè¿‡é‡‡ç”¨ Vue 3 çš„ Composition APIï¼Œç»“åˆ Pinia çŠ¶æ€ç®¡ç†å’Œç²¾å¿ƒè®¾è®¡çš„æœåŠ¡å±‚ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„AIå¯¹è¯ç•Œé¢ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé¡¹ç›®å†…ç½®äº†å®Œæ•´çš„æ¼”ç¤ºæ¨¡å¼ï¼Œå³ä½¿åœ¨æ²¡æœ‰ API å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½æä¾›å®Œæ•´çš„åŠŸèƒ½å±•ç¤ºã€‚

ç¬¬ä¸€ç« ï¼šç³»ç»Ÿæ¶æ„æ·±åº¦è§£æ
1.1 æ•´ä½“æŠ€æœ¯æ¶æ„è®¾è®¡ç†å¿µ
Vue Dify Chat é‡‡ç”¨äº†ç»å…¸çš„ä¸‰å±‚æ¶æ„æ¨¡å¼ï¼Œä½†åœ¨æ¯ä¸€å±‚éƒ½èå…¥äº†ç°ä»£å‰ç«¯å¼€å‘çš„æœ€ä½³å®è·µï¼š

å›¾ç‰‡
æ¶æ„è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š

**è¡¨ç°å±‚ (Presentation Layer)**ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢çš„å±•ç¤ºå’Œäº¤äº’é€»è¾‘ã€‚è¿™ä¸€å±‚é‡‡ç”¨äº† Vue 3 çš„ Composition APIï¼Œä½¿å¾—ç»„ä»¶é€»è¾‘æ›´åŠ æ¸…æ™°å’Œå¯å¤ç”¨ã€‚é€šè¿‡ Ant Design Vue æä¾›ç»Ÿä¸€çš„ UI è®¾è®¡è¯­è¨€ï¼Œç¡®ä¿äº†ç•Œé¢çš„ä¸€è‡´æ€§å’Œä¸“ä¸šæ€§ã€‚

**ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)**ï¼šè¿™æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒï¼Œé€šè¿‡ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œå°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å°è£…åœ¨ stores ä¸­ã€‚æ‰€æœ‰çš„ä¼šè¯ç®¡ç†ã€æ¶ˆæ¯å¤„ç†ã€çŠ¶æ€åŒæ­¥ç­‰æ ¸å¿ƒåŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ã€‚

**æ•°æ®è®¿é—®å±‚ (Data Access Layer)**ï¼šä¸“é—¨è´Ÿè´£ä¸å¤–éƒ¨ API çš„é€šä¿¡ï¼Œå°è£…äº†æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚é€»è¾‘ã€‚é€šè¿‡æœåŠ¡å±‚æ¨¡å¼ï¼Œå°† API è°ƒç”¨é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘å®Œå…¨åˆ†ç¦»ï¼Œæé«˜äº†ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

1.2 æ–‡ä»¶ç»„ç»‡ä¸æ¨¡å—åŒ–è®¾è®¡
é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ä½“ç°äº†æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œé«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡åŸåˆ™ï¼š

src/
â”œâ”€â”€ components/          # å¯å¤ç”¨UIç»„ä»¶
â”‚   â”œâ”€â”€ MainChat.vue    # ä¸»èŠå¤©ç•Œé¢ - è´Ÿè´£æ¶ˆæ¯å±•ç¤ºå’Œè¾“å…¥å¤„ç†
â”‚   â”œâ”€â”€ Message.vue     # å•æ¡æ¶ˆæ¯ç»„ä»¶ - æ”¯æŒMarkdownæ¸²æŸ“å’Œäº¤äº’
â”‚   â””â”€â”€ Sidebar.vue     # ä¼šè¯ç®¡ç†ä¾§è¾¹æ  - æ”¯æŒå“åº”å¼å¸ƒå±€
â”œâ”€â”€ views/              # é¡µé¢çº§å®¹å™¨ç»„ä»¶
â”‚   â””â”€â”€ Chat.vue        # ä¸»é¡µé¢å®¹å™¨ - åè°ƒå„ç»„ä»¶é—´çš„é€šä¿¡
â”œâ”€â”€ stores/             # PiniaçŠ¶æ€ç®¡ç†æ¨¡å—
â”‚   â””â”€â”€ chat.js         # èŠå¤©çŠ¶æ€ç®¡ç† - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ services/           # APIæœåŠ¡å±‚
â”‚   â””â”€â”€ dify.js         # Dify APIé›†æˆ - å¤„ç†æ‰€æœ‰å¤–éƒ¨é€šä¿¡
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°åº“
â”‚   â””â”€â”€ helpers.js      # é€šç”¨å·¥å…· - Markdownæ¸²æŸ“ã€æ—¶é—´æ ¼å¼åŒ–ç­‰
â””â”€â”€ assets/             # é™æ€èµ„æº
    â””â”€â”€ style.css       # å…¨å±€æ ·å¼å®šä¹‰
æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£èŒƒå›´ï¼Œè¿™ç§è®¾è®¡ä½¿å¾—é¡¹ç›®å…·æœ‰æå¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚å½“éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œå¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°ç›¸åº”çš„æ–‡ä»¶ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–æ¨¡å—çš„ç¨³å®šæ€§ã€‚

1.3 æŠ€æœ¯é€‰å‹çš„æ·±å±‚æ¬¡è€ƒé‡
Vue 3 Composition API çš„é€‰æ‹©ç†ç”±ï¼š

æä¾›æ›´å¥½çš„ TypeScript æ”¯æŒ
é€»è¾‘å¤ç”¨æ›´åŠ çµæ´»
æ€§èƒ½ä¼˜åŒ–æ›´åŠ ç²¾ç»†
æ›´é€‚åˆå¤æ‚åº”ç”¨çš„çŠ¶æ€ç®¡ç†
Pinia vs Vuex çš„æŠ€æœ¯å†³ç­–ï¼š

API æ›´åŠ ç®€æ´ç›´è§‚
å®Œå…¨æ”¯æŒ TypeScript
æ›´å¥½çš„å¼€å‘è€…å·¥å…·æ”¯æŒ
æ¨¡å—åŒ–è®¾è®¡æ›´åŠ æ¸…æ™°
ç¬¬äºŒç« ï¼šæ ¸å¿ƒçŠ¶æ€ç®¡ç†æ¶æ„
2.1 Pinia Store è®¾è®¡å“²å­¦
çŠ¶æ€ç®¡ç†æ˜¯æ•´ä¸ªåº”ç”¨çš„ç¥ç»ä¸­æ¢ï¼ŒVue Dify Chat çš„çŠ¶æ€è®¾è®¡ä½“ç°äº†å¯¹å¤æ‚ä¸šåŠ¡åœºæ™¯çš„æ·±åº¦ç†è§£ï¼š

interface ChatState {
  conversations: Conversation[]           // å½“å‰æ´»è·ƒä¼šè¯åˆ—è¡¨
  historyConversations: HistoryConv[]     // æœåŠ¡å™¨å†å²ä¼šè¯
  currentConversationId: string | null    // å½“å‰æ¿€æ´»ä¼šè¯æ ‡è¯†
  isLoading: boolean                      // å…¨å±€åŠ è½½çŠ¶æ€
  isLoadingHistory: boolean              // å†å²æ•°æ®åŠ è½½çŠ¶æ€
  error: string | null                   // é”™è¯¯ä¿¡æ¯ç®¡ç†
  abortController: AbortController | null// è¯·æ±‚ä¸­æ­¢æ§åˆ¶
}

interface Conversation {
  id: string                    // æœ¬åœ°å”¯ä¸€æ ‡è¯†ç¬¦
  difyConversationId: string    // Difyå¹³å°ä¼šè¯ID
  title: string                // ä¼šè¯æ˜¾ç¤ºæ ‡é¢˜
  messages: Message[]          // æ¶ˆæ¯å†å²è®°å½•
  createdAt: Date              // åˆ›å»ºæ—¶é—´æˆ³
  updatedAt: Date              // æœ€åæ›´æ–°æ—¶é—´
  isEmpty: boolean             // ç©ºä¼šè¯æ ‡è®°
}

interface Message {
  id: string                   // æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
  role: 'user' | 'assistant'// æ¶ˆæ¯å‘é€è€…è§’è‰²
  content: string             // æ¶ˆæ¯æ–‡æœ¬å†…å®¹
  timestamp: Date             // æ¶ˆæ¯æ—¶é—´æˆ³
  messageId: string           // Difyå¹³å°æ¶ˆæ¯ID
  liked: boolean              // ç”¨æˆ·ç‚¹èµçŠ¶æ€
  disliked: boolean           // ç”¨æˆ·ç‚¹è¸©çŠ¶æ€
}
çŠ¶æ€è®¾è®¡çš„æ ¸å¿ƒè€ƒè™‘ï¼š

åŒé‡IDä½“ç³»ï¼šæ¯ä¸ªä¼šè¯éƒ½åŒæ—¶æ‹¥æœ‰æœ¬åœ°IDå’Œè¿œç¨‹IDï¼Œè¿™ç§è®¾è®¡æ”¯æŒç¦»çº¿æ“ä½œå’Œæ•°æ®åŒæ­¥ã€‚
æ—¶é—´æˆ³ç®¡ç†ï¼šè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯æ”¯æŒäº†æ¶ˆæ¯æ’åºå’Œä¼šè¯ç®¡ç†çš„å„ç§éœ€æ±‚ã€‚
çŠ¶æ€æ ‡è®°ï¼šé€šè¿‡ isEmptyç­‰æ ‡è®°ï¼Œå®ç°äº†æ™ºèƒ½çš„ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
é”™è¯¯çŠ¶æ€éš”ç¦»ï¼šå°†é”™è¯¯çŠ¶æ€ç‹¬ç«‹ç®¡ç†ï¼Œé¿å…äº†é”™è¯¯ä¼ æ’­å’ŒçŠ¶æ€æ±¡æŸ“ã€‚
2.2 çŠ¶æ€æµè½¬çš„å“åº”å¼æ¨¡å¼
Vue Dify Chat å®ç°äº†ä¸€å¥—å®Œæ•´çš„å“åº”å¼çŠ¶æ€ç®¡ç†æ¨¡å¼ï¼š

å›¾ç‰‡
è¿™ç§è®¾è®¡ç¡®ä¿äº†çŠ¶æ€å˜æ›´çš„å¯é¢„æµ‹æ€§å’Œä¸€è‡´æ€§ï¼Œæ¯ä¸ªçŠ¶æ€å˜åŒ–éƒ½ç»è¿‡äº†ä¸¥æ ¼çš„éªŒè¯å’Œå¤„ç†æµç¨‹ã€‚

2.3 å…³é”®çŠ¶æ€æ“ä½œçš„å®ç°ç»†èŠ‚
ä¼šè¯åˆ›å»ºçš„æ™ºèƒ½åŒ–å¤„ç†ï¼š

çŠ¶æ€ç®¡ç†ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†æ˜¯ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ç³»ç»Ÿå®ç°äº†ä¸€å¥—æ™ºèƒ½çš„ä¼šè¯åˆ›å»ºå’Œæ¸…ç†æœºåˆ¶ï¼š

æ“ä½œæ–¹æ³•
è§¦å‘æ¡ä»¶
ä¸šåŠ¡é€»è¾‘
å‰¯ä½œç”¨å¤„ç†
createNewConversation()	
ç”¨æˆ·ç‚¹å‡»æ–°å»º
æ£€æŸ¥ç©ºä¼šè¯å­˜åœ¨æ€§
è‡ªåŠ¨æ¸…ç†å†—ä½™ä¼šè¯
addMessage()	
å‘é€æ¶ˆæ¯
æ›´æ–°ä¼šè¯çŠ¶æ€
è‡ªåŠ¨ç”Ÿæˆä¼šè¯æ ‡é¢˜
updateMessage()	
æµå¼å“åº”
å®æ—¶æ›´æ–°å†…å®¹
è§¦å‘UIé‡æ–°æ¸²æŸ“
loadHistoryConversation()	
é€‰æ‹©å†å²ä¼šè¯
æ•°æ®æ ¼å¼è½¬æ¢
å¼‚æ­¥åŠ è½½æ¶ˆæ¯å†å²
deleteConversation()	
åˆ é™¤æ“ä½œ
æœ¬åœ°å’Œè¿œç¨‹åŒæ­¥åˆ é™¤
æ™ºèƒ½é€‰æ‹©ä¸‹ä¸€ä¸ªä¼šè¯
ç¬¬ä¸‰ç« ï¼šå¯¹è¯ç®¡ç†ç³»ç»Ÿæ·±åº¦å®ç°
3.1 ä¼šè¯åˆ›å»ºçš„æ™ºèƒ½åŒ–æœºåˆ¶
ä¼šè¯åˆ›å»ºæ˜¯æ•´ä¸ªç³»ç»Ÿæœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ï¼ŒVue Dify Chat å®ç°äº†ä¸€å¥—æå…¶æ™ºèƒ½çš„ä¼šè¯ç®¡ç†æœºåˆ¶ï¼š

å›¾ç‰‡
æ™ºèƒ½ä¼šè¯åˆ›å»ºçš„æ ¸å¿ƒä»£ç å®ç°ï¼š

// src/stores/chat.js - é«˜çº§ä¼šè¯åˆ›å»ºé€»è¾‘
const createNewConversation = (title = 'æ–°çš„å¯¹è¯') => {
// ç”Ÿæˆä¼šè¯å¯¹è±¡ï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰æ˜ç¡®çš„ä¸šåŠ¡å«ä¹‰
const conversation = {
    id: uuidv4(),                    // æœ¬åœ°å”¯ä¸€æ ‡è¯†ï¼Œæ”¯æŒç¦»çº¿æ“ä½œ
    difyConversationId: null,        // Difyå¹³å°IDï¼Œåˆå§‹ä¸ºç©ºï¼Œé¦–æ¬¡é€šä¿¡æ—¶åˆ†é…
    title,                          // é»˜è®¤æ ‡é¢˜ï¼Œä¼šåœ¨é¦–æ¡æ¶ˆæ¯åè‡ªåŠ¨æ›´æ–°
    messages: [],                   // æ¶ˆæ¯åˆ—è¡¨ï¼Œåˆå§‹ä¸ºç©ºæ•°ç»„
    createdAt: newDate(),          // ç²¾ç¡®çš„åˆ›å»ºæ—¶é—´æˆ³
    updatedAt: newDate(),          // æœ€åæ›´æ–°æ—¶é—´ï¼Œç”¨äºæ’åºå’Œæ˜¾ç¤º
    isEmpty: true                   // ç©ºä¼šè¯æ ‡è®°ï¼Œç”¨äºæ™ºèƒ½æ¸…ç†
  }

// æ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨ï¼Œç¡®ä¿æœ€æ–°ä¼šè¯æ€»æ˜¯åœ¨æœ€å‰é¢
  conversations.value.unshift(conversation)
  currentConversationId.value = conversation.id
return conversation
}

// src/views/Chat.vue - æ™ºèƒ½ç©ºä¼šè¯å¤„ç†é€»è¾‘
const handleNewConversation = () => {
// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç©ºä¼šè¯ï¼Œé¿å…é‡å¤åˆ›å»º
const existingEmptyConversation = conversations.value.find(conv =>
    conv.isEmpty && conv.title === 'æ–°çš„å¯¹è¯' && conv.messages.length === 0
  )

if (existingEmptyConversation) {
    // å¤ç”¨ç°æœ‰ç©ºä¼šè¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
    chatStore.setCurrentConversation(existingEmptyConversation.id)
  } else {
    // å…ˆæ¸…ç†å†—ä½™ä¼šè¯ï¼Œå†åˆ›å»ºæ–°ä¼šè¯
    cleanupEmptyConversations()
    chatStore.createNewConversation()
  }
}

// ç©ºä¼šè¯æ¸…ç†æœºåˆ¶ - é˜²æ­¢ä¼šè¯åˆ—è¡¨è†¨èƒ€
const cleanupEmptyConversations = () => {
const emptyConversations = conversations.value.filter(conv =>
    conv.isEmpty && 
    conv.messages.length === 0 && 
    conv.id !== currentConversationId.value &&
    conv.title === 'æ–°çš„å¯¹è¯'// åªæ¸…ç†é»˜è®¤æ ‡é¢˜çš„ç©ºä¼šè¯
  )

// æ‰¹é‡åˆ é™¤ç©ºä¼šè¯ï¼Œä¿æŒåˆ—è¡¨æ•´æ´
  emptyConversations.forEach(conv => {
    chatStore.deleteConversation(conv.id)
  })
}
è¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼šé¿å…äº†é‡å¤åˆ›å»ºç©ºä¼šè¯çš„å›°æ‰°
æ€§èƒ½æå‡ï¼šå‡å°‘äº†ä¸å¿…è¦çš„DOMæ“ä½œå’Œå†…å­˜å ç”¨
ä¸€è‡´æ€§ä¿è¯ï¼šç¡®ä¿ç•Œé¢çŠ¶æ€çš„é€»è¾‘ä¸€è‡´æ€§
3.2 å†å²ä¼šè¯åŒæ­¥çš„å¤æ‚æœºåˆ¶
å†å²ä¼šè¯åŒæ­¥æ˜¯ä¸€ä¸ªæ¶‰åŠå¤šä¸ªæ•°æ®æºçš„å¤æ‚è¿‡ç¨‹ï¼Œéœ€è¦å¤„ç†æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®çš„ä¸€è‡´æ€§ï¼š

å›¾ç‰‡
å†å²æ•°æ®å¤„ç†çš„æ ¸å¿ƒå®ç°ï¼š

// src/services/dify.js - æ”¯æŒæ¼”ç¤ºæ¨¡å¼çš„å†å²æ•°æ®è·å–
async getConversations() {
try {
    if (!this.apiKey) {
      // æ¼”ç¤ºæ¨¡å¼ï¼šè¿”å›ç²¾å¿ƒè®¾è®¡çš„æ¨¡æ‹Ÿæ•°æ®
      return {
        data: [
          {
            id: 'demo_conv_1',
            name: 'å…³äºJavaScriptçš„è®¨è®º',
            created_at: newDate(Date.now() - 86400000).toISOString(),
            inputs: {}
          },
          // æ›´å¤šæ¼”ç¤ºæ•°æ®...
        ],
        has_more: false,
        limit: 20
      }
    }

    // ç”Ÿäº§æ¨¡å¼ï¼šè°ƒç”¨çœŸå®API
    const response = awaitthis.client.get('/conversations', {
      params: {
        user: 'vue-chat-user',
        last_id: '',
        limit: 20
      }
    })
    return response.data
  } catch (error) {
    console.error('Failed to get conversations:', error)
    throw error
  }
}

// src/components/Sidebar.vue - æ™ºèƒ½ä¼šè¯åˆ—è¡¨åˆå¹¶
const allConversations = computed(() => {
const all = []

// ç¬¬ä¸€æ­¥ï¼šæ·»åŠ æ‰€æœ‰å½“å‰æ´»è·ƒä¼šè¯
  props.conversations.forEach(conv => {
    all.push(conv)
  })

// ç¬¬äºŒæ­¥ï¼šæ·»åŠ æœªåŠ è½½çš„å†å²ä¼šè¯
  props.historyConversations.forEach(historyConv => {
    // å»é‡æ£€æŸ¥ï¼šé¿å…å†å²ä¼šè¯å’Œå½“å‰ä¼šè¯é‡å¤æ˜¾ç¤º
    const existsInCurrent = props.conversations.some(conv =>
      conv.difyConversationId === historyConv.id
    )
    
    if (!existsInCurrent) {
      // è½¬æ¢ä¸ºç»Ÿä¸€çš„æ•°æ®æ ¼å¼
      all.push({
        id: `history_${historyConv.id}`,
        difyConversationId: historyConv.id,
        title: historyConv.name || 'æœªå‘½åå¯¹è¯',
        createdAt: newDate(historyConv.created_at),
        updatedAt: newDate(historyConv.created_at),
        isHistory: true,
        originalHistoryData: historyConv  // ä¿ç•™åŸå§‹æ•°æ®ç”¨äºåŠ è½½
      })
    }
  })

// ç¬¬ä¸‰æ­¥ï¼šæŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—ï¼Œç¡®ä¿ä¸€è‡´çš„æ˜¾ç¤ºé¡ºåº
return all.sort((a, b) =>newDate(b.createdAt) - newDate(a.createdAt))
})
3.3 ä¼šè¯æ¢å¤çš„å®Œæ•´æµç¨‹
ä¼šè¯æ¢å¤æ˜¯ä¸€ä¸ªæ¶‰åŠæ•°æ®è½¬æ¢ã€çŠ¶æ€åŒæ­¥å’ŒUIæ›´æ–°çš„å¤æ‚è¿‡ç¨‹ï¼š

// src/views/Chat.vue - å®Œæ•´çš„ä¼šè¯æ¢å¤å®ç°
const handleLoadHistoryConversation = async (historyConv) => {
try {
    // é˜¶æ®µä¸€ï¼šç¯å¢ƒå‡†å¤‡
    cleanupEmptyConversations()  // æ¸…ç†ç¯å¢ƒ
    
    // é˜¶æ®µäºŒï¼šä¼šè¯è½¬æ¢
    const conversation = chatStore.loadHistoryConversation(historyConv)
    
    // é˜¶æ®µä¸‰ï¼šå¼‚æ­¥æ•°æ®åŠ è½½
    chatStore.setLoadingHistory(true)
    const messagesResponse = await difyService.getConversationMessages(historyConv.id)
    
    // é˜¶æ®µå››ï¼šæ•°æ®æ ¼å¼è½¬æ¢å’ŒçŠ¶æ€æ›´æ–°
    chatStore.loadHistoryMessages(conversation.id, messagesResponse.data || [])
    
    // é˜¶æ®µäº”ï¼šç”¨æˆ·ç•Œé¢æ›´æ–°
    isMobileSidebarOpen.value = false// ç§»åŠ¨ç«¯ä½“éªŒä¼˜åŒ–
    message.success('å†å²ä¼šè¯å·²åŠ è½½')
    
  } catch (error) {
    console.error('Failed to load history conversation:', error)
    message.error('åŠ è½½å†å²ä¼šè¯å¤±è´¥')
  } finally {
    chatStore.setLoadingHistory(false)
  }
}

// src/stores/chat.js - å†å²æ¶ˆæ¯çš„ç²¾ç¡®è½¬æ¢
const loadHistoryMessages = (conversationId, messages) => {
const conversation = conversations.value.find(conv => conv.id === conversationId)
if (conversation) {
    conversation.messages = []  // æ¸…ç©ºç°æœ‰æ¶ˆæ¯
    
    // Difyæ¶ˆæ¯æ ¼å¼åˆ°æœ¬åœ°æ ¼å¼çš„ç²¾ç¡®è½¬æ¢
    messages.forEach(msg => {
      // ç”¨æˆ·æ¶ˆæ¯è½¬æ¢
      conversation.messages.push({
        id: uuidv4(),
        role: 'user',
        content: msg.query,
        timestamp: newDate(msg.created_at),
        messageId: msg.id + '_user'
      })
      
      // AIå›å¤è½¬æ¢
      conversation.messages.push({
        id: uuidv4(),
        role: 'assistant',
        content: msg.answer,
        timestamp: newDate(msg.created_at),
        messageId: msg.id,
        liked: msg.feedback?.rating === 'like',
        disliked: msg.feedback?.rating === 'dislike'
      })
    })
    
    conversation.updatedAt = newDate()
  }
}
3.4 æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆæœºåˆ¶
æ ‡é¢˜ç”Ÿæˆæ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„é‡è¦ç»†èŠ‚ï¼š

// src/stores/chat.js - åŸºäºé¦–æ¡æ¶ˆæ¯çš„æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆ
const addMessage = (conversationId, message) => {
const conversation = conversations.value.find(conv => conv.id === conversationId)
if (conversation) {
    // æ·»åŠ æ¶ˆæ¯åˆ°ä¼šè¯
    conversation.messages.push({
      id: uuidv4(),
      ...message,
      timestamp: newDate()
    })
    conversation.updatedAt = newDate()
    
    // æ ‡è®°ä¼šè¯çŠ¶æ€å˜æ›´
    if (conversation.isEmpty) {
      conversation.isEmpty = false
    }
    
    // æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆï¼šåŸºäºé¦–æ¡ç”¨æˆ·æ¶ˆæ¯
    if (message.role === 'user' && conversation.messages.length === 1) {
      // æˆªå–å‰30ä¸ªå­—ç¬¦ä½œä¸ºæ ‡é¢˜ï¼Œè¶…é•¿æ˜¾ç¤ºçœç•¥å·
      conversation.title = message.content.slice(0, 30) + 
        (message.content.length > 30 ? '...' : '')
    }
  }
}
ç¬¬å››ç« ï¼šæ¶ˆæ¯æ¸²æŸ“ç³»ç»Ÿçš„æŠ€æœ¯å®ç°
4.1 Markdownæ¸²æŸ“çš„å®Œæ•´æµæ°´çº¿
Vue Dify Chat å®ç°äº†ä¸€å¥—å®Œæ•´çš„Markdownæ¸²æŸ“æµæ°´çº¿ï¼Œæ”¯æŒä»åŸå§‹æ–‡æœ¬åˆ°å¯Œæ–‡æœ¬æ˜¾ç¤ºçš„å…¨è¿‡ç¨‹ï¼š

å›¾ç‰‡
æ ¸å¿ƒæ¸²æŸ“å¼•æ“çš„å®ç°ï¼š

// src/utils/helpers.js - å®Œæ•´çš„Markdownæ¸²æŸ“æµæ°´çº¿
exportconst renderMarkdown = (content) => {
// é˜¶æ®µ1: é¢„å¤„ç† - æ€è€ƒè¿‡ç¨‹æ ‡ç­¾çš„ç‰¹æ®Šå¤„ç†
const processedContent = content.replace(
    /\<think\>([\s\S]*?)\<\/think\>/gi,
    '<div class="ai-thinking">ğŸ’­ <strong>æ€è€ƒè¿‡ç¨‹ï¼š</strong><br>$1</div>'
  )

// é˜¶æ®µ2: Markdownæ ¸å¿ƒæ¸²æŸ“
let renderedHTML = md.render(processedContent)

// é˜¶æ®µ3: å›¾ç‰‡é“¾æ¥çš„æ™ºèƒ½å¤„ç†
// ä»ç¯å¢ƒå˜é‡è·å–Dify APIåŸºç¡€URL
const difyApiUrl = import.meta.env.VITE_DIFY_API_URL || 'https://api.dify.ai/v1'
const difyBaseUrl = difyApiUrl.replace(/\/v1$/, '')

// ç›¸å¯¹è·¯å¾„å›¾ç‰‡é“¾æ¥è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
  renderedHTML = renderedHTML.replace(
    /src="\/files\//g,
    `src="${difyBaseUrl}/files/`
  )

return renderedHTML
}

// Markdown-itå¼•æ“çš„é«˜çº§é…ç½®
const md = new MarkdownIt({
html: true,         // å…è®¸HTMLæ ‡ç­¾
linkify: true,      // è‡ªåŠ¨é“¾æ¥è¯†åˆ«
typographer: true,  // å¯ç”¨å°åˆ·ç¾åŒ–
highlight: function (str, lang) {
    // ä»£ç é«˜äº®çš„ç²¾ç¡®å®ç°
    if (lang && hljs.getLanguage(lang)) {
      try {
        return hljs.highlight(str, { language: lang }).value
      } catch (__) {
        // é™çº§å¤„ç†ï¼šè¯­è¨€ä¸æ”¯æŒæ—¶çš„ä¼˜é›…å¤„ç†
      }
    }
    return''// è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼
  }
})
4.2 AIæ€è€ƒè¿‡ç¨‹çš„ç¾åŒ–å±•ç¤º
AIæ€è€ƒè¿‡ç¨‹çš„å±•ç¤ºæ˜¯ Vue Dify Chat çš„åˆ›æ–°åŠŸèƒ½ï¼Œé€šè¿‡ç‰¹æ®Šçš„æ ·å¼è®¾è®¡æå‡äº†AIäº¤äº’çš„é€æ˜åº¦ï¼š

/* src/components/Message.vue - æ€è€ƒè¿‡ç¨‹çš„è§†è§‰è®¾è®¡ */
.markdown-content:deep(.ai-thinking) {
/* æ¸å˜èƒŒæ™¯ï¼šè¥é€ æ€è€ƒçš„è§†è§‰æ°›å›´ */
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);

/* å·¦ä¾§è¾¹æ¡†ï¼šè§†è§‰å±‚æ¬¡æ ‡è¯† */
border-left: 4px solid #6c757d;

/* å†…è¾¹è·ï¼šç¡®ä¿å†…å®¹çš„å¯è¯»æ€§ */
padding: 12px16px;
margin: 12px0;

/* å­—ä½“è®¾è®¡ï¼šç•¥å°çš„å­—å·çªå‡ºå±‚æ¬¡ */
font-size: 0.9em;
color: #495057;

/* åœ†è§’è®¾è®¡ï¼šç°ä»£åŒ–çš„è§†è§‰æ•ˆæœ */
border-radius: 08px8px0;

/* é˜´å½±æ•ˆæœï¼šå¢åŠ è§†è§‰æ·±åº¦ */
box-shadow: 02px4pxrgba(0,0,0,0.1);
}

.markdown-content:deep(.ai-thinkingstrong) {
color: #495057;
font-weight: 600;
}

/* å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width:768px) {
.markdown-content:deep(.ai-thinking) {
    padding: 10px12px;
    font-size: 0.85em;
    margin: 8px0;
  }
}
4.3 ä»£ç é«˜äº®çš„æŠ€æœ¯å®ç°
ä»£ç é«˜äº®ç³»ç»Ÿæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶æä¾›äº†å®Œæ•´çš„è¯­æ³•ç€è‰²ï¼š

é«˜äº®æ•ˆæœç¤ºä¾‹å¯¹æ¯”ï¼š

// åŸå§‹ä»£ç ï¼ˆæ¸²æŸ“å‰ï¼‰
function calculateFibonacci(n) {
  if (n <= 1) return n;
  return calculateFibonacci(n - 1) + calculateFibonacci(n - 2);
}

// æ¸²æŸ“åçš„HTMLç»“æ„
<pre><code class="language-javascript">
<span class="hljs-keyword">function</span>
<span class="hljs-title function_">calculateFibonacci</span>(<span class="hljs-params">n</span>) {
<span class="hljs-keyword">if</span> (n <= <span class="hljs-number">1</span>) 
<span class="hljs-keyword">return</span> n;
<span class="hljs-keyword">return</span>
<span class="hljs-title function_">calculateFibonacci</span>(n - <span class="hljs-number">1</span>) + 
<span class="hljs-title function_">calculateFibonacci</span>(n - <span class="hljs-number">2</span>);
}
</code></pre>
æ·±åº¦é›†æˆDify APIï¼šåŸºäºVue 3çš„æ™ºèƒ½å¯¹è¯å‰ç«¯è§£å†³æ–¹æ¡ˆï¼ˆäºŒï¼‰
åŸåˆ› dxt145 å¤§æ¨¡å‹RAGå’ŒAgentæŠ€æœ¯å®è·µ
 2025å¹´08æœˆ01æ—¥ 08:50 é™•è¥¿
ç¬¬äº”ç« ï¼šç”¨æˆ·äº¤äº’ç³»ç»Ÿçš„ç²¾ç»†åŒ–å®ç°
5.1 å®æ—¶è¾“å…¥ç³»ç»Ÿçš„å®Œæ•´å®ç°
è¾“å…¥ç³»ç»Ÿæ˜¯ç”¨æˆ·ä¸AIäº¤äº’çš„ç¬¬ä¸€æ¥è§¦ç‚¹ï¼Œéœ€è¦æä¾›æµç•…ã€ç›´è§‚çš„ä½“éªŒï¼š

<!-- src/components/MainChat.vue - é«˜çº§è¾“å…¥ç»„ä»¶è®¾è®¡ -->
<template>
  <div class="chat-input-area">
    <div class="input-container">
      <!-- è‡ªé€‚åº”é«˜åº¦çš„æ–‡æœ¬åŸŸ -->
      <a-textarea
        v-model:value="inputValue"
        :placeholder="isLoading ? 'ç­‰å¾…å›å¤ä¸­...' : 'è¾“å…¥æ¶ˆæ¯...'"
        :disabled="isLoading"
        :auto-size="{ minRows: 1, maxRows: 6 }"
        class="chat-input"
        @keydown="handleKeyDown"
      />

      <!-- æ™ºèƒ½æŒ‰é’®çŠ¶æ€åˆ‡æ¢ -->
      <button
        v-if="!isLoading"
        class="send-btn"
        :disabled="!inputValue.trim()"
        @click="handleSend"
        title="å‘é€æ¶ˆæ¯ (Enter)"
      >
        <SendOutlined />
      </button>

      <button
        v-else
        class="stop-btn"
        @click="$emit('stop-generation')"
        title="åœæ­¢ç”Ÿæˆ (Escape)"
      >
        <StopOutlined />
      </button>
    </div>

    <!-- è¾“å…¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="input-footer" v-if="conversation">
      <span class="message-count">{{ messages.length }} æ¡æ¶ˆæ¯</span>
      <span class="input-hint" v-if="!isLoading">æŒ‰ Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ</span>
    </div>
  </div>
</template>

<script setup>
// é”®ç›˜äº‹ä»¶çš„ç²¾ç»†åŒ–å¤„ç†
const handleKeyDown = (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault()  // é˜»æ­¢é»˜è®¤çš„æ¢è¡Œè¡Œä¸º
    handleSend()
  } else if (e.key === 'Escape' && isLoading.value) {
    // Escapeé”®å¿«é€Ÿåœæ­¢ç”Ÿæˆ
    emit('stop-generation')
  }
}

// å‘é€é€»è¾‘çš„å®Œæ•´å®ç°
const handleSend = () => {
  if (inputValue.value.trim() && !props.isLoading) {
    emit('send-message', inputValue.value.trim())
    inputValue.value = ''  // ç«‹å³æ¸…ç©ºè¾“å…¥æ¡†ï¼Œæä¾›å³æ—¶åé¦ˆ
  }
}
</script>
è¾“å…¥ç»„ä»¶çš„CSSç²¾ç»†åŒ–è®¾è®¡ï¼š

.chat-input {
width: 100%;
border: 1px solid #d9d9d9;
border-radius: 8px;
padding: 12px16px;
font-size: 14px;
line-height: 1.5;
resize: none;
transition: all 0.3scubic-bezier(0.4, 0, 0.2, 1);
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.chat-input:focus {
border-color: #1677ff;
box-shadow: 0002pxrgba(22, 119, 255, 0.2);
outline: none;
}

.chat-input:disabled {
background-color: #f5f5f5;
cursor: not-allowed;
color: #999;
}

/* å‘é€æŒ‰é’®çš„çŠ¶æ€å˜åŒ–åŠ¨ç”» */
.send-btn, .stop-btn {
min-width: 40px;
height: 40px;
border: none;
border-radius: 6px;
cursor: pointer;
transition: all 0.2s ease;
display: flex;
align-items: center;
justify-content: center;
}

.send-btn {
background: #1677ff;
color: white;
}

.send-btn:hover:not(:disabled) {
background: #0958d9;
transform: translateY(-1px);
}

.send-btn:disabled {
background: #d9d9d9;
cursor: not-allowed;
}

.stop-btn {
background: #ff4d4f;
color: white;
}

.stop-btn:hover {
background: #d9363e;
}
5.2 æµå¼å“åº”çš„ä¸­æ­¢æ§åˆ¶æœºåˆ¶
ä¸­æ­¢æ§åˆ¶æ˜¯ä¿è¯ç”¨æˆ·ä½“éªŒçš„é‡è¦åŠŸèƒ½ï¼Œéœ€è¦åœ¨å¤šä¸ªå±‚é¢å®ç°ï¼š

// src/services/dify.js - APIå±‚é¢çš„ä¸­æ­¢æ§åˆ¶
const sendMessage = async (message, difyConversationId, onMessage, abortController) => {
try {
    const response = await fetch(`${this.baseURL}/chat-messages`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        inputs: {},
        query: message,
        response_mode: 'streaming',
        conversation_id: difyConversationId || "",
        user: 'vue-chat-user'
      }),
      signal: abortController?.signal  // å…³é”®ï¼šç»‘å®šä¸­æ­¢ä¿¡å·
    })

    const reader = response.body.getReader()
    const decoder = new TextDecoder()
    let buffer = ''

    try {
      while (true) {
        // æ¯æ¬¡è¯»å–å‰æ£€æŸ¥ä¸­æ­¢çŠ¶æ€
        if (abortController?.signal.aborted) {
          reader.cancel()  // å–æ¶ˆè¯»å–å™¨
          thrownewError('ç”¨æˆ·åœæ­¢äº†ç”Ÿæˆ')
        }

        const { done, value } = await reader.read()
        if (done) break

        // æµå¼æ•°æ®å¤„ç†é€»è¾‘...
        buffer += decoder.decode(value, { stream: true })
        // å¤„ç†SSEæ•°æ®åŒ…...
      }
    } catch (error) {
      if (error.name === 'AbortError' || error.message === 'ç”¨æˆ·åœæ­¢äº†ç”Ÿæˆ') {
        console.log('è¯·æ±‚è¢«ç”¨æˆ·ä¸­æ­¢')
        thrownewError('ç”Ÿæˆå·²åœæ­¢')
      }
      throw error
    }
  } catch (error) {
    console.error('Dify API Error:', error)
    throw error
  }
}

// src/stores/chat.js - çŠ¶æ€å±‚é¢çš„ä¸­æ­¢æ§åˆ¶
const createAbortController = () => {
  abortController.value = new AbortController()
return abortController.value
}

const abortCurrentRequest = () => {
if (abortController.value) {
    abortController.value.abort()  // è§¦å‘ä¸­æ­¢ä¿¡å·
    abortController.value = null
    setLoading(false)
  }
}

const clearAbortController = () => {
  abortController.value = null
}
5.3 æ¶ˆæ¯æ“ä½œåé¦ˆç³»ç»Ÿ
æ¶ˆæ¯æ“ä½œåé¦ˆæä¾›äº†ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½ï¼š

<!-- src/components/Message.vue - æ¶ˆæ¯æ“ä½œæŒ‰é’®ç»„ -->
<div class="message-actions" v-if="message.role === 'assistant' && message.content">
  <!-- å¤åˆ¶åŠŸèƒ½ï¼šæ”¯æŒçº¯æ–‡æœ¬å’Œæ ¼å¼åŒ–å¤åˆ¶ -->
  <a-tooltip title="å¤åˆ¶æ¶ˆæ¯å†…å®¹">
    <button class="action-btn" @click="$emit('copy')">
      <CopyOutlined />
    </button>
  </a-tooltip>

  <!-- ç‚¹èµåŠŸèƒ½ï¼šæ”¯æŒçŠ¶æ€åˆ‡æ¢ -->
  <a-tooltip title="è¿™ä¸ªå›ç­”æœ‰å¸®åŠ©">
    <button 
      :class="['action-btn', { active: message.liked }]" 
      @click="handleLike"
    >
      <LikeOutlined />
    </button>
  </a-tooltip>

  <!-- ç‚¹è¸©åŠŸèƒ½ï¼šæ”¯æŒçŠ¶æ€åˆ‡æ¢ -->
  <a-tooltip title="è¿™ä¸ªå›ç­”éœ€è¦æ”¹è¿›">
    <button 
      :class="['action-btn', { active: message.disliked }]" 
      @click="handleDislike"
    >
      <DislikeOutlined />
    </button>
  </a-tooltip>
</div>

<script setup>
// åé¦ˆæ“ä½œçš„ä¸šåŠ¡é€»è¾‘
const handleLike = () => {
  if (props.message.liked) {
    // å–æ¶ˆç‚¹èµ
    emit('like')
  } else {
    emit('like')
  }
}

const handleDislike = () => {
  if (props.message.disliked) {
    // å–æ¶ˆç‚¹è¸©
    emit('dislike')
  } else {
    emit('dislike')
  }
}
</script>
åé¦ˆæ“ä½œçš„å®Œæ•´å¤„ç†æµç¨‹ï¼š

// src/views/Chat.vue - åé¦ˆæ“ä½œçš„ä¸šåŠ¡é€»è¾‘å¤„ç†
const handleLikeMessage = async (messageId) => {
try {
    const message = currentMessages.value.find(msg => msg.id === messageId)
    if (message?.messageId) {
      // åŒæ­¥åˆ°DifyæœåŠ¡å™¨
      await difyService.feedbackMessage(message.messageId, 'like')
    }
    
    // æ›´æ–°æœ¬åœ°çŠ¶æ€
    chatStore.likeMessage(currentConversationId.value, messageId)
    
    // ç”¨æˆ·åé¦ˆ
    message.success('æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼')
  } catch (error) {
    console.error('Like message error:', error)
    message.error('åé¦ˆæäº¤å¤±è´¥ï¼Œè¯·é‡è¯•')
  }
}

const handleCopyMessage = async (content) => {
try {
    // å°è¯•ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
    await navigator.clipboard.writeText(content)
    message.success('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  } catch (error) {
    // é™çº§åˆ°ä¼ ç»Ÿå¤åˆ¶æ–¹æ³•
    const textArea = document.createElement('textarea')
    textArea.value = content
    document.body.appendChild(textArea)
    textArea.select()
    document.execCommand('copy')
    document.body.removeChild(textArea)
    message.success('å†…å®¹å·²å¤åˆ¶')
  }
}
ç¬¬å…­ç« ï¼šæµå¼å“åº”ä¸å®æ—¶æ›´æ–°æœºåˆ¶
6.1 Server-Sent Events (SSE) çš„å®Œæ•´å®ç°
Vue Dify Chat å®ç°äº†å®Œæ•´çš„SSEæµå¼å“åº”å¤„ç†ï¼Œæ”¯æŒå®æ—¶çš„AIå¯¹è¯ä½“éªŒï¼š


SSEæ•°æ®å¤„ç†çš„æ ¸å¿ƒå®ç°ï¼š

// src/services/dify.js - å®Œæ•´çš„SSEæµå¤„ç†
const reader = response.body.getReader()
const decoder = new TextDecoder()
let buffer = ''
let fullResponse = ''
let messageId = null
let conversationIdFromResponse = difyConversationId

try {
while (true) {
    // å®æ—¶æ£€æŸ¥ä¸­æ­¢çŠ¶æ€
    if (abortController?.signal.aborted) {
      reader.cancel()
      thrownewError('ç”¨æˆ·åœæ­¢äº†ç”Ÿæˆ')
    }

    const { done, value } = await reader.read()
    if (done) break

    // å¤„ç†æµå¼æ•°æ®å—
    buffer += decoder.decode(value, { stream: true })
    const lines = buffer.split('\n')
    buffer = lines.pop() || ''// ä¿ç•™ä¸å®Œæ•´çš„è¡Œ

    for (const line of lines) {
      if (line.startsWith('data: ')) {
        try {
          const data = JSON.parse(line.slice(6))
          console.log('SSEæ•°æ®:', data)
          
          // å¤„ç†ä¸åŒç±»å‹çš„SSEäº‹ä»¶
          if (data.event === 'message') {
            fullResponse += data.answer || ''
            messageId = data.message_id
            conversationIdFromResponse = data.conversation_id
            
            // å®æ—¶æ›´æ–°UI
            if (onMessage) {
              onMessage({
                type: 'content',
                content: fullResponse,
                messageId,
                conversationId: conversationIdFromResponse
              })
            }
          } elseif (data.event === 'message_end') {
            // æ¶ˆæ¯å®Œæˆäº‹ä»¶
            if (onMessage) {
              onMessage({
                type: 'end',
                content: fullResponse,
                messageId,
                conversationId: conversationIdFromResponse,
                metadata: data.metadata
              })
            }
          } elseif (data.event === 'error') {
            thrownewError(data.message || 'Stream error occurred')
          }
        } catch (parseError) {
          console.warn('Failed to parse SSE data:', line, parseError)
        }
      }
    }
  }
} catch (error) {
if (error.name === 'AbortError' || error.message === 'ç”¨æˆ·åœæ­¢äº†ç”Ÿæˆ') {
    console.log('è¯·æ±‚è¢«ç”¨æˆ·ä¸­æ­¢')
    thrownewError('ç”Ÿæˆå·²åœæ­¢')
  }
throw error
}
6.2 æ™ºèƒ½æ»šåŠ¨ç³»ç»Ÿçš„ç²¾ç»†åŒ–å®ç°
æ™ºèƒ½æ»šåŠ¨ç³»ç»Ÿéœ€è¦å¹³è¡¡è‡ªåŠ¨æ»šåŠ¨å’Œç”¨æˆ·æ§åˆ¶ä¹‹é—´çš„å…³ç³»ï¼š

// src/components/MainChat.vue - æ™ºèƒ½æ»šåŠ¨æ§åˆ¶ç³»ç»Ÿ
const isUserScrolling = ref(false)
const lastScrollTop = ref(0)
const showScrollButton = ref(false)

// æ£€æµ‹ç”¨æˆ·æ˜¯å¦åœ¨æ¶ˆæ¯åº•éƒ¨
const isNearBottom = () => {
if (!messagesContainer.value) returntrue
const container = messagesContainer.value
const threshold = 100// 100pxçš„å®¹å·®èŒƒå›´
return container.scrollTop + container.clientHeight >= container.scrollHeight - threshold
}

// æ™ºèƒ½æ»šåŠ¨å†³ç­–é€»è¾‘
const smartScroll = () => {
if (isNearBottom() && !isUserScrolling.value) {
    scrollToBottom()  // ç”¨æˆ·åœ¨åº•éƒ¨æ—¶è‡ªåŠ¨æ»šåŠ¨
  }
  updateScrollButton()  // æ›´æ–°æ»šåŠ¨æŒ‰é’®çŠ¶æ€
}

// é«˜æ€§èƒ½é˜²æŠ–æ»šåŠ¨å¤„ç†
const debounceSmartScroll = (() => {
let timeoutId = null
return() => {
    if (timeoutId) clearTimeout(timeoutId)
    timeoutId = setTimeout(() => {
      smartScroll()
    }, 16) // çº¦60fpsçš„æ›´æ–°é¢‘ç‡
  }
})()

// ç”¨æˆ·æ»šåŠ¨è¡Œä¸ºæ£€æµ‹
const handleScroll = () => {
if (!messagesContainer.value) return

const currentScrollTop = messagesContainer.value.scrollTop

// æ»šåŠ¨æ–¹å‘æ£€æµ‹
if (currentScrollTop < lastScrollTop.value || !isNearBottom()) {
    // ç”¨æˆ·å‘ä¸Šæ»šåŠ¨æˆ–ç¦»å¼€åº•éƒ¨
    isUserScrolling.value = true
  } elseif (isNearBottom()) {
    // ç”¨æˆ·è¿”å›åº•éƒ¨ï¼Œæ¢å¤è‡ªåŠ¨æ»šåŠ¨
    isUserScrolling.value = false
  }

  lastScrollTop.value = currentScrollTop
  updateScrollButton()
}

// æ»šåŠ¨æŒ‰é’®çŠ¶æ€æ›´æ–°
const updateScrollButton = () => {
  showScrollButton.value = !isNearBottom() && props.messages.length > 0
}
6.3 åŠ è½½åŠ¨ç”»ç³»ç»Ÿçš„å®Œæ•´è®¾è®¡
åŠ è½½åŠ¨ç”»æä¾›äº†é‡è¦çš„è§†è§‰åé¦ˆï¼š

<!-- src/components/Message.vue - ç²¾ç¾çš„åŠ è½½åŠ¨ç”» -->
<div v-if="isLoading && !message.content" class="loading-dots">
  <span class="dot-1"></span>
  <span class="dot-2"></span>
  <span class="dot-3"></span>
</div>

<style scoped>
.loading-dots {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 12px 0;
}

.loading-dots span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #8e8ea0;
  animation: loading 1.4s ease-in-out infinite both;
}

/* åˆ›é€ æ³¢æµªå¼çš„åŠ è½½æ•ˆæœ */
.loading-dots .dot-1 { animation-delay: -0.32s; }
.loading-dots .dot-2 { animation-delay: -0.16s; }
.loading-dots .dot-3 { animation-delay: 0s; }

@keyframes loading {
  0%, 80%, 100% {
    transform: scale(0.8);
    opacity: 0.5;
  }
  40% {
    transform: scale(1.2);
    opacity: 1;
  }
}

/* ç§»åŠ¨ç«¯åŠ è½½åŠ¨ç”»ä¼˜åŒ– */
@media (max-width: 768px) {
  .loading-dots span {
    width: 6px;
    height: 6px;
  }
}
</style>
ç¬¬ä¸ƒç« ï¼šå“åº”å¼è®¾è®¡ä¸è·¨è®¾å¤‡é€‚é…
7.1 å“åº”å¼è®¾è®¡çš„ç³»ç»Ÿæ€§æ–¹æ¡ˆ
Vue Dify Chat é‡‡ç”¨äº†ç§»åŠ¨ä¼˜å…ˆçš„å“åº”å¼è®¾è®¡ç­–ç•¥ï¼š

/* åŸºç¡€å¸ƒå±€ï¼šç§»åŠ¨ä¼˜å…ˆè®¾è®¡ */
.chat-layout {
display: flex;
height: 100vh;
overflow: hidden;
}

/* ä¾§è¾¹æ çš„å“åº”å¼é€‚é… */
.sidebar {
width: 260px;
background: #171717;
border-right: 1px solid #3e3e46;
display: flex;
flex-direction: column;
height: 100vh;
position: relative;
transition: width 0.3scubic-bezier(0.4, 0, 0.2, 1);
}

/* æ¡Œé¢ç«¯ï¼šå›ºå®šä¾§è¾¹æ  */
@media (min-width:769px) {
.sidebar {
    position: relative;
    transform: translateX(0);
  }

.sidebar.collapsed {
    width: 60px;
  }

.main-chat {
    flex: 1;
    margin-left: 0;
  }
}

/* ç§»åŠ¨ç«¯ï¼šæŠ½å±‰å¼ä¾§è¾¹æ  */
@media (max-width:768px) {
.sidebar {
    position: fixed;
    left: -100%;
    top: 0;
    z-index: 1000;
    width: 280px;
    transition: left 0.3scubic-bezier(0.4, 0, 0.2, 1);
  }

.sidebar.open {
    left: 0;
    box-shadow: 2px08pxrgba(0, 0, 0, 0.15);
  }

.main-chat {
    width: 100%;
    margin-left: 0;
  }

/* ç§»åŠ¨ç«¯é®ç½©å±‚ */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

.sidebar.open + .sidebar-overlay {
    opacity: 1;
    visibility: visible;
  }
}

/* è¶…å¤§å±å¹•é€‚é… */
@media (min-width:1440px) {
.sidebar {
    width: 320px;
  }

.main-chat {
    max-width: 1200px;
    margin: 0 auto;
  }
}
7.2 æ–­ç‚¹ç³»ç»Ÿä¸è®¾å¤‡é€‚é…ç­–ç•¥
æ–­ç‚¹å®šä¹‰ä¸ä½¿ç”¨åœºæ™¯ï¼š

æ–­ç‚¹èŒƒå›´
è®¾å¤‡ç±»å‹
ä¾§è¾¹æ è¡Œä¸º
ä¸»è¦ä¼˜åŒ–
< 576px
è¶…å°å±æ‰‹æœº
å…¨å±æŠ½å±‰
å­—ä½“ç¼©å°ã€é—´è·å‹ç¼©
576px - 768px
æ‰‹æœºæ¨ªå±
å…¨å±æŠ½å±‰
ä¼˜åŒ–è§¦æ‘¸ç›®æ ‡
769px - 1024px
å¹³æ¿ç«–å±
å›ºå®šä¾§è¾¹æ 
å¹³è¡¡å¸ƒå±€æ¯”ä¾‹
1025px - 1440px
æ¡Œé¢ç«¯
å¯æ”¶èµ·ä¾§è¾¹æ 
å®Œæ•´åŠŸèƒ½å±•ç¤º
> 1440px
å¤§å±æ˜¾ç¤ºå™¨
å®½ç‰ˆä¾§è¾¹æ 
å†…å®¹å±…ä¸­é™å®½
ç¬¬å…«ç« ï¼šæ€§èƒ½ä¼˜åŒ–ä¸ç”¨æˆ·ä½“éªŒæå‡
8.1 è™šæ‹ŸåŒ–ä¸é«˜æ€§èƒ½æ¸²æŸ“
æ¶ˆæ¯åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š

// src/components/MainChat.vue - é«˜æ€§èƒ½æ¶ˆæ¯æ¸²æŸ“
const messageListRef = ref(null)
const visibleMessages = computed(() => {
// å¯¹äºå¤§é‡æ¶ˆæ¯çš„æ€§èƒ½ä¼˜åŒ–
if (props.messages.length > 100) {
    const scrollTop = messageListRef.value?.scrollTop || 0
    const containerHeight = messageListRef.value?.clientHeight || 0
    const itemHeight = 80// ä¼°ç®—çš„æ¶ˆæ¯é«˜åº¦
    
    const startIndex = Math.max(0, Math.floor(scrollTop / itemHeight) - 5)
    const endIndex = Math.min(
      props.messages.length,
      Math.ceil((scrollTop + containerHeight) / itemHeight) + 5
    )
    
    return props.messages.slice(startIndex, endIndex)
  }

return props.messages
})

// ä½¿ç”¨ key ç¡®ä¿é«˜æ•ˆçš„ diff ç®—æ³•
const getMessageKey = (message, index) => {
return`${message.id || message.messageId}_${index}`
}
8.2 å†…å­˜ç®¡ç†ä¸èµ„æºæ¸…ç†
å®Œæ•´çš„æ¸…ç†æœºåˆ¶ï¼š

// src/views/Chat.vue - ç³»ç»Ÿæ€§çš„å†…å­˜ç®¡ç†
onUnmounted(() => {
// æ¸…ç†å®šæ—¶å™¨
if (scrollTimer.value) {
    clearInterval(scrollTimer.value)
  }

// æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
if (messagesContainer.value) {
    messagesContainer.value.removeEventListener('scroll', handleScroll)
  }

// ä¸­æ­¢æœªå®Œæˆçš„è¯·æ±‚
  chatStore.abortCurrentRequest()

// æ¸…ç†å¤§é‡æ•°æ®ï¼ˆä¿ç•™æœ€è¿‘50æ¡æ¶ˆæ¯ï¼‰
if (chatStore.conversations.length > 0) {
    chatStore.conversations.forEach(conv => {
      if (conv.messages.length > 50) {
        conv.messages = conv.messages.slice(-50)
      }
    })
  }
})

// è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶
const startGarbageCollection = () => {
  setInterval(() => {
    // æ¸…ç†è¶…è¿‡24å°æ—¶çš„ç©ºä¼šè¯
    const now = newDate()
    const emptyConversations = chatStore.conversations.filter(conv =>
      conv.isEmpty && 
      conv.messages.length === 0 && 
      now - newDate(conv.createdAt) > 24 * 60 * 60 * 1000
    )
    
    emptyConversations.forEach(conv => {
      chatStore.deleteConversation(conv.id)
    })
  }, 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
}
ç¬¬ä¹ç« ï¼šå®‰å…¨æ€§ä¸é”™è¯¯å¤„ç†
9.1 å®Œæ•´çš„å®‰å…¨é˜²æŠ¤ä½“ç³»
XSSé˜²æŠ¤çš„å¤šå±‚å®ç°ï¼š

// src/utils/helpers.js - å®‰å…¨çš„Markdownæ¸²æŸ“
import DOMPurify from'dompurify'

exportconst renderMarkdown = (content) => {
// ç¬¬ä¸€å±‚ï¼šè¾“å…¥éªŒè¯
if (typeof content !== 'string') {
    console.warn('Invalid content type for markdown rendering')
    return''
  }

// ç¬¬äºŒå±‚ï¼šé•¿åº¦é™åˆ¶
if (content.length > 100000) {
    console.warn('Content too long for rendering')
    return'<p>å†…å®¹è¿‡é•¿ï¼Œæ— æ³•æ˜¾ç¤º</p>'
  }

// ç¬¬ä¸‰å±‚ï¼šæ€è€ƒæ ‡ç­¾çš„å®‰å…¨å¤„ç†
const processedContent = content.replace(
    /<think>([\s\S]*?)<\/think>/gi,
    (match, thinkContent) => {
      // å¯¹æ€è€ƒå†…å®¹è¿›è¡ŒHTMLè½¬ä¹‰
      const escapedContent = thinkContent
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#x27;')
      
      return`<div class="ai-thinking">ğŸ’­ <strong>æ€è€ƒè¿‡ç¨‹ï¼š</strong><br>${escapedContent}</div>`
    }
  )

// ç¬¬å››å±‚ï¼šMarkdownæ¸²æŸ“
let renderedHTML = md.render(processedContent)

// ç¬¬äº”å±‚ï¼šHTMLå‡€åŒ–
  renderedHTML = DOMPurify.sanitize(renderedHTML, {
    ALLOWED_TAGS: [
      'p', 'br', 'strong', 'em', 'u', 'strike', 'code', 'pre', 
      'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
      'ul', 'ol', 'li', 'blockquote', 'a', 'img', 'table', 'thead', 
      'tbody', 'tr', 'th', 'td', 'div', 'span'
    ],
    ALLOWED_ATTR: ['href', 'target', 'src', 'alt', 'class', 'title'],
    ALLOWED_URI_REGEXP: /^(?:https?|ftp|mailto|data):/
  })

return renderedHTML
}
9.2 é”™è¯¯è¾¹ç•Œä¸ä¼˜é›…é™çº§
å…¨å±€é”™è¯¯å¤„ç†ç³»ç»Ÿï¼š

// src/main.js - å…¨å±€é”™è¯¯æ•è·
app.config.errorHandler = (err, vm, info) => {
console.error('Vue Error:', err, info)

// é”™è¯¯ä¸ŠæŠ¥
if (process.env.NODE_ENV === 'production') {
    // å‘é€é”™è¯¯æŠ¥å‘Šåˆ°ç›‘æ§ç³»ç»Ÿ
    sendErrorReport({
      message: err.message,
      stack: err.stack,
      info,
      url: window.location.href,
      userAgent: navigator.userAgent
    })
  }

// ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
  message.error('ç³»ç»Ÿå‡ºç°å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
}

// æœªå¤„ç†çš„ Promise æ‹’ç»
window.addEventListener('unhandledrejection', event => {
console.error('Unhandled promise rejection:', event.reason)
  event.preventDefault()

// æ ¹æ®é”™è¯¯ç±»å‹æä¾›ä¸åŒçš„ç”¨æˆ·æç¤º
if (event.reason?.name === 'NetworkError') {
    message.error('ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•')
  } elseif (event.reason?.message?.includes('API')) {
    message.error('æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•')
  } else {
    message.error('æ“ä½œå¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
  }
})

// èµ„æºåŠ è½½é”™è¯¯å¤„ç†
window.addEventListener('error', event => {
if (event.target !== window) {
    console.error('Resource loading error:', event.target.src || event.target.href)
    message.warning('éƒ¨åˆ†èµ„æºåŠ è½½å¤±è´¥ï¼Œå¯èƒ½å½±å“æ˜¾ç¤ºæ•ˆæœ')
  }
}, true)
ç¬¬åç« ï¼šæ‰©å±•æ€§è®¾è®¡ä¸æœªæ¥è§„åˆ’
10.1 æ’ä»¶åŒ–æ¶æ„è®¾è®¡
å¯æ‰©å±•çš„æ¶ˆæ¯æ¸²æŸ“å™¨ï¼š

// src/utils/messageRenderers.js - æ’ä»¶åŒ–æ¶ˆæ¯æ¸²æŸ“ç³»ç»Ÿ
class MessageRendererRegistry {
constructor() {
    this.renderers = newMap()
    this.middleware = []
  }

// æ³¨å†Œè‡ªå®šä¹‰æ¸²æŸ“å™¨
  register(type, renderer) {
    this.renderers.set(type, renderer)
  }

// æ·»åŠ ä¸­é—´ä»¶
  use(middleware) {
    this.middleware.push(middleware)
  }

// æ¸²æŸ“æ¶ˆæ¯
  render(message) {
    let content = message.content
    
    // æ‰§è¡Œä¸­é—´ä»¶
    for (const middleware ofthis.middleware) {
      content = middleware(content, message)
    }
    
    // æ£€æŸ¥è‡ªå®šä¹‰æ¸²æŸ“å™¨
    for (const [type, renderer] ofthis.renderers) {
      if (renderer.test(content)) {
        return renderer.render(content)
      }
    }
    
    // é»˜è®¤æ¸²æŸ“
    return renderMarkdown(content)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const registry = new MessageRendererRegistry()

// æ³¨å†Œå›¾è¡¨æ¸²æŸ“å™¨
registry.register('chart', {
test: (content) => content.includes('```chart'),
render: (content) => {
    // æ¸²æŸ“å›¾è¡¨çš„é€»è¾‘
    return renderChart(content)
  }
})

// æ³¨å†Œä»£ç æ‰§è¡Œå™¨
registry.register('code', {
test: (content) => content.includes('```executable'),
render: (content) => {
    // å¯æ‰§è¡Œä»£ç çš„æ¸²æŸ“é€»è¾‘
    return renderExecutableCode(content)
  }
})
10.2 å›½é™…åŒ–æ”¯æŒæ¶æ„
å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒï¼š

// src/i18n/index.js - å›½é™…åŒ–é…ç½®
import { createI18n } from'vue-i18n'

const messages = {
'zh-CN': {
    chat: {
      newConversation: 'æ–°çš„å¯¹è¯',
      sendMessage: 'å‘é€æ¶ˆæ¯',
      stopGeneration: 'åœæ­¢ç”Ÿæˆ',
      thinkingProcess: 'æ€è€ƒè¿‡ç¨‹',
      copySuccess: 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
      loadingHistory: 'åŠ è½½å†å²ä¼šè¯...'
    }
  },
'en-US': {
    chat: {
      newConversation: 'New Conversation',
      sendMessage: 'Send Message',
      stopGeneration: 'Stop Generation',
      thinkingProcess: 'Thinking Process',
      copySuccess: 'Copied to clipboard',
      loadingHistory: 'Loading history...'
    }
  }
}

exportconst i18n = createI18n({
legacy: false,
locale: navigator.language.startsWith('zh') ? 'zh-CN' : 'en-US',
fallbackLocale: 'en-US',
  messages
})
æ€»ç»“ä¸æŠ€æœ¯ä»·å€¼
Vue Dify Chat é¡¹ç›®ä»£è¡¨äº†ç°ä»£å‰ç«¯å¼€å‘çš„æœ€ä½³å®è·µï¼Œå…¶æŠ€æœ¯æ¶æ„å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä»·å€¼ï¼š

æŠ€æœ¯åˆ›æ–°ç‚¹
æ™ºèƒ½ä¼šè¯ç®¡ç†ï¼šå®ç°äº†ä¸šç•Œé¢†å…ˆçš„ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶
æµå¼å“åº”å¤„ç†ï¼šå®Œæ•´çš„SSEæµå¼æ•°æ®å¤„ç†å’Œä¸­æ­¢æ§åˆ¶
AIæ€è€ƒè¿‡ç¨‹å¯è§†åŒ–ï¼šåˆ›æ–°çš„æ€è€ƒè¿‡ç¨‹å±•ç¤ºæ–¹æ¡ˆ
å“åº”å¼æ¶æ„ï¼šç§»åŠ¨ä¼˜å…ˆçš„å…¨è®¾å¤‡é€‚é…ç­–ç•¥
æ€§èƒ½ä¼˜åŒ–ï¼šå¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†æœºåˆ¶
å·¥ç¨‹å®è·µä»·å€¼
å¯ç»´æŠ¤æ€§ï¼šæ¸…æ™°çš„æ¨¡å—åŒ–æ¶æ„å’ŒèŒè´£åˆ†ç¦»
å¯æ‰©å±•æ€§ï¼šæ’ä»¶åŒ–è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•
å¯é æ€§ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œä¼˜é›…é™çº§
ç”¨æˆ·ä½“éªŒï¼šç»†è‡´å…¥å¾®çš„äº¤äº’è®¾è®¡å’Œè§†è§‰åé¦ˆ
å¼€å‘ä½“éªŒï¼šç°ä»£åŒ–çš„å¼€å‘å·¥å…·é“¾å’Œå·¥ç¨‹é…ç½®


é˜…è¯» 3410