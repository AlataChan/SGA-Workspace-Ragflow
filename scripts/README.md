# RAGFlow API æµ‹è¯•è„šæœ¬

æœ¬ç›®å½•åŒ…å«ç”¨äºŽæµ‹è¯•RAGFlow APIé›†æˆçš„è„šæœ¬å’Œå·¥å…·ã€‚

---

## ðŸ“ æ–‡ä»¶è¯´æ˜Ž

| æ–‡ä»¶ | ç”¨é€” | è¿è¡Œæ–¹å¼ |
|------|------|---------|
| `setup-ragflow-test.sh` | äº¤äº’å¼é…ç½®æµ‹è¯•çŽ¯å¢ƒ | `./scripts/setup-ragflow-test.sh` |
| `test-ragflow-api.ts` | æµ‹è¯•å¯¹è¯åŠŸèƒ½ (Agent/Dialog) | `npx tsx scripts/test-ragflow-api.ts` |
| `test-ragflow-knowledge-base.ts` | æµ‹è¯•çŸ¥è¯†åº“åŠŸèƒ½ | `npx tsx scripts/test-ragflow-knowledge-base.ts` |

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨é…ç½®è„šæœ¬ (æŽ¨è)

```bash
# 1. è¿è¡Œé…ç½®è„šæœ¬
./scripts/setup-ragflow-test.sh

# 2. æŒ‰æç¤ºè¾“å…¥RAGFlowé…ç½®ä¿¡æ¯
#    - RAGFlow URL (å¦‚: http://localhost:9380)
#    - API Key (ä»ŽRAGFlowç•Œé¢èŽ·å–)
#    - Agent ID (å¯é€‰)
#    - KB ID (å¯é€‰)

# 3. è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»º.env.localå¹¶æµ‹è¯•è¿žæŽ¥

# 4. é€‰æ‹©æ˜¯å¦ç«‹å³è¿è¡Œæµ‹è¯•
```

### æ–¹æ³•2: æ‰‹åŠ¨é…ç½®

```bash
# 1. åˆ›å»º.env.localæ–‡ä»¶
cat > .env.local << EOF
RAGFLOW_URL=http://localhost:9380
RAGFLOW_API_KEY=your-api-key-here
RAGFLOW_AGENT_ID=your-agent-id-here
RAGFLOW_KB_ID=your-kb-id-here
EOF

# 2. è¿è¡Œæµ‹è¯•
npx tsx scripts/test-ragflow-api.ts
npx tsx scripts/test-ragflow-knowledge-base.ts
```

---

## ðŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®ä¿RAGFlowæœåŠ¡è¿è¡Œ

**é€‰é¡¹A: æœ¬åœ°RAGFlow**

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:9380/api/health

# è®¿é—®Webç•Œé¢
open http://localhost:9380
```

**é€‰é¡¹B: Dockeréƒ¨ç½²RAGFlow**

```bash
# å…‹éš†å¹¶å¯åŠ¨RAGFlow
git clone https://github.com/infiniflow/ragflow.git
cd ragflow
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨ (çº¦2-3åˆ†é’Ÿ)
docker-compose logs -f
```

### 2. èŽ·å–APIå¯†é’¥

1. è®¿é—® http://localhost:9380
2. ç™»å½•è´¦æˆ·
3. è¿›å…¥ **è®¾ç½®** â†’ **APIå¯†é’¥**
4. åˆ›å»ºæ–°å¯†é’¥å¹¶å¤åˆ¶

### 3. åˆ›å»ºAgent (å¯é€‰)

å¦‚æžœè¦æµ‹è¯•å¯¹è¯åŠŸèƒ½:

1. åœ¨RAGFlowç•Œé¢åˆ›å»ºAgent
2. å¤åˆ¶Agent ID

---

## ðŸ§ª æµ‹è¯•è¯´æ˜Ž

### æµ‹è¯•1: å¯¹è¯åŠŸèƒ½

**æµ‹è¯•å†…å®¹**:
- âœ… Agentæ¨¡å¼å¯¹è¯
- âœ… Dialogæ¨¡å¼å¯¹è¯
- âœ… æµå¼è¾“å‡º
- âœ… é”™è¯¯å¤„ç†

**è¿è¡Œå‘½ä»¤**:
```bash
npx tsx scripts/test-ragflow-api.ts
```

**é¢„æœŸç»“æžœ**:
```
ðŸš€ å¼€å§‹RAGFlow APIæµ‹è¯•

============================================================
ðŸ§ª æµ‹è¯•1: é…ç½®éªŒè¯
============================================================
âœ… Base URL: http://localhost:9380
âœ… API Key: ragflow-BlMGQyNzM0OT...
âœ… Agent ID: your-agent-id

============================================================
ðŸ§ª æµ‹è¯•2: Agentæ¨¡å¼ - å‘é€æ¶ˆæ¯
============================================================
â„¹ï¸  å‘é€æµ‹è¯•æ¶ˆæ¯: "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"
...........
âœ… æ¶ˆæ¯å‘é€å®Œæˆ
âœ… Agentæ¨¡å¼æµ‹è¯•é€šè¿‡

============================================================
æ€»è®¡: 3/3 æµ‹è¯•é€šè¿‡
============================================================
```

---

### æµ‹è¯•2: çŸ¥è¯†åº“åŠŸèƒ½

**æµ‹è¯•å†…å®¹**:
- âœ… åˆ—å‡ºçŸ¥è¯†åº“
- âœ… åˆ›å»ºçŸ¥è¯†åº“
- âœ… èŽ·å–çŸ¥è¯†å›¾è°±
- âœ… åˆ—å‡ºæ–‡æ¡£

**è¿è¡Œå‘½ä»¤**:
```bash
npx tsx scripts/test-ragflow-knowledge-base.ts
```

**é¢„æœŸç»“æžœ**:
```
ðŸš€ å¼€å§‹RAGFlowçŸ¥è¯†åº“APIæµ‹è¯•

============================================================
ðŸ§ª æµ‹è¯•1: åˆ—å‡ºçŸ¥è¯†åº“
============================================================
âœ… æˆåŠŸèŽ·å–çŸ¥è¯†åº“åˆ—è¡¨
â„¹ï¸  çŸ¥è¯†åº“æ•°é‡: 3

çŸ¥è¯†åº“åˆ—è¡¨:
  1. å›½è´¸åˆ¶åº¦çŸ¥è¯†åº“ (ID: dc949110906a11f08b78aa7cd3e67281)
     æ–‡æ¡£æ•°: 31, åˆ†å—æ•°: 566

============================================================
æ€»è®¡: 4/4 æµ‹è¯•é€šè¿‡
============================================================
```

---

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### é—®é¢˜1: è¿žæŽ¥å¤±è´¥

**é”™è¯¯**: `fetch failed` æˆ– `ECONNREFUSED`

**è§£å†³**:
```bash
# æ£€æŸ¥RAGFlowæ˜¯å¦è¿è¡Œ
curl http://localhost:9380/api/health

# æ£€æŸ¥ç«¯å£
netstat -an | grep 9380
```

### é—®é¢˜2: è®¤è¯å¤±è´¥

**é”™è¯¯**: `401 Unauthorized`

**è§£å†³**:
1. ç¡®è®¤APIå¯†é’¥æ ¼å¼æ­£ç¡® (ä»¥ `ragflow-` å¼€å¤´)
2. é‡æ–°ç”ŸæˆAPIå¯†é’¥
3. æ£€æŸ¥çŽ¯å¢ƒå˜é‡

```bash
# éªŒè¯çŽ¯å¢ƒå˜é‡
echo $RAGFLOW_API_KEY
```

### é—®é¢˜3: Agentä¸å­˜åœ¨

**é”™è¯¯**: `Agent not found`

**è§£å†³**:
1. åœ¨RAGFlowç•Œé¢ç¡®è®¤Agentå·²åˆ›å»º
2. å¤åˆ¶æ­£ç¡®çš„Agent ID
3. ç¡®è®¤AgentçŠ¶æ€ä¸º"å·²å‘å¸ƒ"

---

## ðŸ“Š æµ‹è¯•è¦†ç›–

| åŠŸèƒ½ | è¦†ç›–çŽ‡ | çŠ¶æ€ |
|------|--------|------|
| Agentå¯¹è¯ | 100% | âœ… |
| Dialogå¯¹è¯ | 100% | âœ… |
| çŸ¥è¯†åº“åˆ—è¡¨ | 100% | âœ… |
| çŸ¥è¯†åº“åˆ›å»º | 100% | âœ… |
| çŸ¥è¯†å›¾è°± | 100% | âœ… |
| æ–‡æ¡£åˆ—è¡¨ | 100% | âœ… |
| æ–‡æ¡£ä¸Šä¼  | 0% | â­ï¸ |
| æ–‡æ¡£åˆ é™¤ | 0% | â­ï¸ |

**æ€»ä½“è¦†ç›–çŽ‡**: çº¦ 60%

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [RAGFlow APIæµ‹è¯•æŒ‡å—](../docs/ragflow-api-testing-guide.md) - è¯¦ç»†æµ‹è¯•æ–‡æ¡£
- [RAGFlow APIå®Œæ•´ä½¿ç”¨æŒ‡å—](../docs/RAGFlow_APIå®Œæ•´ä½¿ç”¨æŒ‡å—.md) - APIå‚è€ƒ
- [çŸ¥è¯†å›¾è°±å®žçŽ°è·¯çº¿](../docs/knowledge-graph-implementation-roadmap.md) - æŠ€æœ¯å®žçŽ°

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åŽ:

1. âœ… é›†æˆåˆ°å‰ç«¯åº”ç”¨
2. âœ… ç¼–å†™æ›´å¤šæµ‹è¯•ç”¨ä¾‹
3. âœ… éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒ
4. âœ… æ·»åŠ ç›‘æŽ§å’Œæ—¥å¿—

---

## ðŸ’¡ æç¤º

- é¦–æ¬¡è¿è¡Œå»ºè®®ä½¿ç”¨ `setup-ragflow-test.sh` è¿›è¡Œé…ç½®
- æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»º `.env.local` æ–‡ä»¶
- å¯ä»¥é€šè¿‡çŽ¯å¢ƒå˜é‡è¦†ç›–é…ç½®
- æ‰€æœ‰æµ‹è¯•éƒ½æ˜¯éžç ´åæ€§çš„ï¼Œä¸ä¼šä¿®æ”¹çŽ°æœ‰æ•°æ®

