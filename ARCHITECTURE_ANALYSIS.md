# ğŸ—ï¸ é¡¹ç›®æ¶æ„æ·±åº¦åˆ†æ

## ğŸ“‹ å½“å‰æ¶æ„é—®é¢˜

### 1. æ•°æ®åº“æ¶æ„æ··ä¹±

#### ğŸ”„ å¤šå¥—Schemaå†²çª
```
prisma/schema.prisma (SQLite)
â”œâ”€â”€ Company, User, AIAgent, ChatSession...
â”œâ”€â”€ ç”¨äºæœ¬åœ°å¼€å‘å’Œæµ‹è¯•

scripts/001_create_database_schema.sql (PostgreSQL)  
â”œâ”€â”€ companies, profiles, ai_agents, chat_sessions...
â”œâ”€â”€ åŸºäºSupabaseçš„ç”Ÿäº§schema

lib/database/chat-schema.sql
â”œâ”€â”€ chat_sessions, chat_messages
â”œâ”€â”€ ä¸“é—¨çš„èŠå¤©æ•°æ®ç»“æ„

supabase/migrations/20241227_create_chat_tables.sql
â”œâ”€â”€ åˆä¸€å¥—èŠå¤©è¡¨ç»“æ„
â”œâ”€â”€ ä¸ä¸Šé¢çš„schemaä¸ä¸€è‡´
```

#### ğŸ”‘ è®¤è¯ç³»ç»Ÿé‡å¤
```
Supabase Auth (ä¸»è¦)
â”œâ”€â”€ auth.users è¡¨
â”œâ”€â”€ RLS ç­–ç•¥
â”œâ”€â”€ JWT tokens

SimpleAuth (è‡ªå®šä¹‰)
â”œâ”€â”€ lib/auth/simple-auth.ts
â”œâ”€â”€ ç”¨æˆ·åå¯†ç éªŒè¯
â”œâ”€â”€ è‡ªå®šä¹‰JWT

NextAuth (é…ç½®ä½†æœªä½¿ç”¨)
â”œâ”€â”€ NEXTAUTH_SECRET ç¯å¢ƒå˜é‡
â”œâ”€â”€ ä½†ä»£ç ä¸­æœªè§å®é™…ä½¿ç”¨
```

### 2. æ•°æ®å­˜å‚¨ç­–ç•¥ä¸ç»Ÿä¸€

#### ğŸ“± å‰ç«¯å­˜å‚¨ (ç¦»çº¿ä¼˜å…ˆ)
```
IndexedDB (ä¸»è¦)
â”œâ”€â”€ app/utils/indexedDB-storage.ts
â”œâ”€â”€ ZustandæŒä¹…åŒ–å­˜å‚¨
â”œâ”€â”€ èŠå¤©ä¼šè¯å’Œæ¶ˆæ¯

localStorage (å¤‡ç”¨)
â”œâ”€â”€ ç”¨æˆ·ä¿¡æ¯
â”œâ”€â”€ è®¤è¯token
â”œâ”€â”€ é…ç½®æ•°æ®
```

#### ğŸ—„ï¸ åç«¯å­˜å‚¨
```
Supabase PostgreSQL (ç”Ÿäº§)
â”œâ”€â”€ ç”¨æˆ·å’Œä¼ä¸šæ•°æ®
â”œâ”€â”€ AI Agenté…ç½®
â”œâ”€â”€ èŠå¤©å†å² (å¯é€‰)

æœ¬åœ°SQLite (å¼€å‘)
â”œâ”€â”€ Prisma schema
â”œâ”€â”€ å¼€å‘æµ‹è¯•ç”¨
```

### 3. é¡¹ç›®ç»“æ„æ··åˆ

#### ğŸ“ åŒé‡æ¶æ„
```
ä¸»é¡¹ç›® (ä¼ä¸šAIå·¥ä½œç©ºé—´)
â”œâ”€â”€ app/ - Next.js 13+ App Router
â”œâ”€â”€ lib/ - ä¸šåŠ¡é€»è¾‘å’Œå·¥å…·
â”œâ”€â”€ components/ - UIç»„ä»¶
â”œâ”€â”€ ä¼ä¸šçº§å¤šç§Ÿæˆ·æ¶æ„

nextchat-reference/ (å‚è€ƒå®ç°)
â”œâ”€â”€ app/ - åŸç‰ˆNextChatç»“æ„
â”œâ”€â”€ å•ç”¨æˆ·èŠå¤©åº”ç”¨
â”œâ”€â”€ ä¸åŒçš„çŠ¶æ€ç®¡ç†å’ŒAPI
```

## ğŸ¯ ç»Ÿä¸€æ¶æ„è®¾è®¡

### 1. æ•°æ®åº“ç»Ÿä¸€æ–¹æ¡ˆ

#### ğŸ—„ï¸ ä¸»æ•°æ®åº“ (PostgreSQL)
```sql
-- æ ¸å¿ƒä¸šåŠ¡æ•°æ®
companies (ä¼ä¸š)
users (ç”¨æˆ·) 
ai_agents (AIæ™ºèƒ½ä½“)
user_agent_access (æƒé™)

-- èŠå¤©æ•°æ®
chat_sessions (ä¼šè¯)
chat_messages (æ¶ˆæ¯)

-- çŸ¥è¯†åº“
knowledge_bases (çŸ¥è¯†åº“)
knowledge_documents (æ–‡æ¡£)
document_chunks (æ–‡æ¡£å—)

-- æ–‡ä»¶ç®¡ç†
file_uploads (æ–‡ä»¶ä¸Šä¼ )
```

#### ğŸ” å‘é‡æ•°æ®åº“ (Qdrant)
```
çŸ¥è¯†åº“é›†åˆ
â”œâ”€â”€ æ–‡æ¡£åµŒå…¥å‘é‡
â”œâ”€â”€ è¯­ä¹‰æœç´¢ç´¢å¼•
â”œâ”€â”€ å…ƒæ•°æ®è¿‡æ»¤

èŠå¤©å†å²é›†åˆ
â”œâ”€â”€ å¯¹è¯åµŒå…¥
â”œâ”€â”€ ç›¸ä¼¼å¯¹è¯æ£€ç´¢
```

#### âš¡ ç¼“å­˜å±‚ (Redis)
```
ä¼šè¯ç¼“å­˜
â”œâ”€â”€ ç”¨æˆ·ä¼šè¯çŠ¶æ€
â”œâ”€â”€ èŠå¤©ä¸Šä¸‹æ–‡
â”œâ”€â”€ ä¸´æ—¶æ•°æ®

é€Ÿç‡é™åˆ¶
â”œâ”€â”€ APIè°ƒç”¨é™åˆ¶
â”œâ”€â”€ ç”¨æˆ·æ“ä½œé™åˆ¶
```

### 2. è®¤è¯ç³»ç»Ÿç»Ÿä¸€

#### ğŸ” Supabase Auth (ä¸»è¦)
```
ç”¨æˆ·æ³¨å†Œ/ç™»å½•
â”œâ”€â”€ auth.users (Supabaseç®¡ç†)
â”œâ”€â”€ profiles (ä¸šåŠ¡æ‰©å±•)
â”œâ”€â”€ RLSç­–ç•¥æ§åˆ¶

ä¼ä¸šå¤šç§Ÿæˆ·
â”œâ”€â”€ åŸºäºcompany_idéš”ç¦»
â”œâ”€â”€ è§’è‰²æƒé™æ§åˆ¶
```

#### ğŸ›¡ï¸ æƒé™æ§åˆ¶
```
è§’è‰²ç³»ç»Ÿ
â”œâ”€â”€ super_admin (è¶…çº§ç®¡ç†å‘˜)
â”œâ”€â”€ admin (ä¼ä¸šç®¡ç†å‘˜)  
â”œâ”€â”€ user (æ™®é€šç”¨æˆ·)

èµ„æºæƒé™
â”œâ”€â”€ ä¼ä¸šæ•°æ®éš”ç¦»
â”œâ”€â”€ AI Agentè®¿é—®æ§åˆ¶
â”œâ”€â”€ èŠå¤©å†å²æƒé™
```

### 3. æ•°æ®æµè®¾è®¡

#### ğŸ“± å‰ç«¯æ•°æ®æµ
```
ç”¨æˆ·æ“ä½œ
â”œâ”€â”€ ZustandçŠ¶æ€ç®¡ç†
â”œâ”€â”€ IndexedDBç¦»çº¿å­˜å‚¨
â”œâ”€â”€ è‡ªåŠ¨åŒæ­¥åˆ°åç«¯

èŠå¤©åŠŸèƒ½
â”œâ”€â”€ å®æ—¶æ¶ˆæ¯æµ
â”œâ”€â”€ æœ¬åœ°ç¼“å­˜ä¼˜å…ˆ
â”œâ”€â”€ åå°æ•°æ®åŒæ­¥
```

#### ğŸ”„ åç«¯æ•°æ®æµ
```
APIå±‚
â”œâ”€â”€ Next.js API Routes
â”œâ”€â”€ è®¤è¯ä¸­é—´ä»¶
â”œâ”€â”€ æƒé™éªŒè¯

ä¸šåŠ¡å±‚
â”œâ”€â”€ æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ AI Agentè°ƒç”¨
â”œâ”€â”€ æ–‡ä»¶å¤„ç†

å­˜å‚¨å±‚
â”œâ”€â”€ PostgreSQL (ç»“æ„åŒ–)
â”œâ”€â”€ Qdrant (å‘é‡)
â”œâ”€â”€ Redis (ç¼“å­˜)
â”œâ”€â”€ MinIO (æ–‡ä»¶)
```

## ğŸ³ Dockeræ¶æ„é‡æ–°è®¾è®¡

### æœåŠ¡ç»„ä»¶
```
nginx (18000) - APIç½‘å…³
â”œâ”€â”€ ç»Ÿä¸€å…¥å£
â”œâ”€â”€ è´Ÿè½½å‡è¡¡
â”œâ”€â”€ SSLç»ˆæ­¢

app (18080) - Next.jsåº”ç”¨
â”œâ”€â”€ SSR/SSG
â”œâ”€â”€ API Routes
â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘

postgres (15432) - ä¸»æ•°æ®åº“
â”œâ”€â”€ ä¸šåŠ¡æ•°æ®
â”œâ”€â”€ ç”¨æˆ·è®¤è¯
â”œâ”€â”€ èŠå¤©å†å²

qdrant (16333) - å‘é‡æ•°æ®åº“
â”œâ”€â”€ çŸ¥è¯†åº“
â”œâ”€â”€ è¯­ä¹‰æœç´¢

redis (16379) - ç¼“å­˜
â”œâ”€â”€ ä¼šè¯çŠ¶æ€
â”œâ”€â”€ é€Ÿç‡é™åˆ¶

minio (19000) - å¯¹è±¡å­˜å‚¨
â”œâ”€â”€ æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ é™æ€èµ„æº
```

### æ•°æ®æŒä¹…åŒ–
```
postgres_data - ä¸»æ•°æ®åº“
qdrant_data - å‘é‡æ•°æ®
redis_data - ç¼“å­˜æ•°æ®
minio_data - æ–‡ä»¶å­˜å‚¨
app_uploads - åº”ç”¨æ–‡ä»¶
```

## ğŸ”§ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: æ•°æ®åº“ç»Ÿä¸€
1. åˆå¹¶æ‰€æœ‰schemaåˆ°ç»Ÿä¸€çš„PostgreSQL
2. åˆ›å»ºå®Œæ•´çš„è¿ç§»è„šæœ¬
3. ç»Ÿä¸€è®¤è¯ç³»ç»Ÿåˆ°Supabase Auth

### é˜¶æ®µ2: DockeråŒ–
1. è®¾è®¡ç»Ÿä¸€çš„å®¹å™¨æ¶æ„
2. é…ç½®æ•°æ®æŒä¹…åŒ–
3. ç½‘ç»œå’Œå®‰å…¨é…ç½®

### é˜¶æ®µ3: æ•°æ®åŒæ­¥
1. å‰åç«¯æ•°æ®åŒæ­¥æœºåˆ¶
2. ç¦»çº¿åŠŸèƒ½æ”¯æŒ
3. å†²çªè§£å†³ç­–ç•¥

è¿™æ ·çš„æ¶æ„èƒ½å¤Ÿï¼š
âœ… è§£å†³æ•°æ®åº“æ··ä¹±é—®é¢˜
âœ… ç»Ÿä¸€è®¤è¯å’Œæƒé™
âœ… æ”¯æŒä¼ä¸šå¤šç§Ÿæˆ·
âœ… æä¾›å®Œæ•´çš„çŸ¥è¯†åº“åŠŸèƒ½
âœ… ä¿æŒå‰ç«¯ç¦»çº¿ä¼˜å…ˆä½“éªŒ
